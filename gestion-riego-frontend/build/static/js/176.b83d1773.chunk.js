"use strict";(self.webpackChunkgestion_riego_pwa=self.webpackChunkgestion_riego_pwa||[]).push([[176],{4176:(t,e,a)=>{a.d(e,{default:()=>s});var r=a(1105),o=a(5239),i=a.n(o),n=a(9581);const s=class{constructor(){this.pdfDoc=null,this.currentPage=null,this.currentY=0,this.pageHeight=792,this.pageWidth=612,this.margin=57,this.contentWidth=498,this.templatePaths=[`${window.location.protocol}//${window.location.hostname}:3000/assets/hoja_membretada_2.pdf`,"/assets/hoja_membretada_2.pdf","./assets/hoja_membretada_2.pdf","/public/assets/hoja_membretada_2.pdf","./public/assets/hoja_membretada_2.pdf",`${window.location.origin}/assets/hoja_membretada_2.pdf`,`${window.location.origin}/public/assets/hoja_membretada_2.pdf`],this.font=null,this.boldFont=null,this.usingTemplate=!1}async generateReport(t,e,a){try{console.log("\ud83d\ude80 Iniciando generaci\xf3n de informe PDF"),this.pdfDoc=await r.PDFDocument.create(),this.font=await this.pdfDoc.embedFont(r.StandardFonts.Helvetica),this.boldFont=await this.pdfDoc.embedFont(r.StandardFonts.HelveticaBold),await this.loadTemplate(),this.currentY=this.usingTemplate?600:650,await this.addReportTitle(t.nombre_campo),console.log("\u23f3 Esperando carga de gr\xe1ficos..."),await this.waitForChartsToLoad(),await this.addResumenCirculosFromPage(e),await this.addRecomendaciones(a);for(const t of e)await this.addLoteDetalleCompleto(t);const o=await this.pdfDoc.save(),i=new Blob([o],{type:"application/pdf"}),s=URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.download=`Informe_Balance_Hidrico_${t.nombre_campo}_${(0,n.GP)(new Date,"dd-MM-yyyy")}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(s),console.log("\u2705 Informe PDF generado exitosamente")}catch(o){throw console.error("\u274c Error generando PDF:",o),o}}async waitForChartsToLoad(){let t=0;for(;t<5e3;){const e=document.querySelectorAll("canvas");let a=!0;for(const t of e){const e=t.getContext("2d");if(e&&t.width>100&&t.height>100){if(!e.getImageData(0,0,t.width,t.height).data.some((t=>0!==t))){a=!1;break}}}if(a&&e.length>0)return void console.log("\u2705 Gr\xe1ficos cargados correctamente");await new Promise((t=>setTimeout(t,100))),t+=100}console.warn("\u26a0\ufe0f Timeout esperando gr\xe1ficos, continuando...")}async verifyTemplateAtPath(t){try{console.log(`\ud83d\udd0d Verificando plantilla en: ${t}`);const e=await fetch(t,{method:"GET",headers:{Accept:"application/pdf,*/*","Cache-Control":"no-cache"},mode:"cors",credentials:"same-origin"});if(!e.ok)return console.warn(`\u274c Template not found at: ${t} (${e.status})`),!1;const a=e.headers.get("content-type");if(console.log("\ud83d\udccb Content-Type:",a),a&&a.includes("text/html")){if(console.warn(`\u274c Received HTML instead of PDF at: ${t}`),t.includes("/assets/")){console.log("\ud83d\udca1 Sugerencia: Problema de proxy/nginx detectado"),console.log("\ud83d\udca1 El servidor interno funciona, pero hay un proxy intermedio");const t=await e.text();console.log("\ud83d\udcc4 Contenido HTML recibido (primeros 200 chars):",t.substring(0,200))}return!1}const r=e.headers.get("content-length");if(console.log("\ud83d\udccf Content-Length:",r),r&&48185!==parseInt(r)&&console.warn(`\u26a0\ufe0f Content-Length inesperado: ${r}, esperado: 48185`),"0"===r)return console.warn("\u274c Template file is empty"),!1;const o=await e.arrayBuffer();if(console.log("\ud83d\udce6 ArrayBuffer size:",o.byteLength,"bytes"),0===o.byteLength)return console.warn("\u274c Template arrayBuffer is empty"),!1;if(o.byteLength<1024){console.warn(`\u274c File too small (${o.byteLength} bytes), probably an error page`);const t=(new TextDecoder).decode(o.slice(0,200));return console.warn("\ud83d\udcc4 Contenido recibido:",t),!1}const i=new Uint8Array(o),n=String.fromCharCode(...i.slice(0,4));if(console.log("\ud83d\udd24 PDF Header:",n),"%PDF"!==n){console.warn(`\u274c Invalid PDF header: ${n}`);const t=String.fromCharCode(...i.slice(0,Math.min(50,i.length)));return console.warn("\ud83d\udcc4 Primeros 50 bytes:",t),!1}return console.log(`\u2705 Template verified successfully at: ${t}`),console.log(`\ud83d\udcca PDF Stats: ${o.byteLength} bytes, Content-Type: ${a}`),{valid:!0,arrayBuffer:o}}catch(e){return console.warn(`\u274c Error verifying template at ${t}:`,e.message),!1}}async loadTemplate(){try{console.log("\ud83d\udcc4 Intentando cargar plantilla desde m\xfaltiples rutas...");for(const e of this.templatePaths){console.log(`\ud83d\udd0d Probando ruta: ${e}`);const a=await this.verifyTemplateAtPath(e);if(a){console.log(`\u2705 Plantilla encontrada en: ${e}`);try{const t=await r.PDFDocument.load(a.arrayBuffer),o=t.getPages();if(0===o.length){console.warn("\u274c Template has no pages");continue}if(!o[0]){console.warn("\u274c First page is invalid");continue}const[i]=await this.pdfDoc.copyPages(t,[0]);if(!i){console.warn("\u274c Failed to copy template page");continue}return this.currentPage=this.pdfDoc.addPage([this.pageWidth,this.pageHeight]),this.currentPage.drawPage(i,{x:0,y:0,width:this.pageWidth,height:this.pageHeight}),this.usingTemplate=!0,this.templatePath=e,void console.log("\u2705 Template loaded successfully")}catch(t){console.warn(`\u274c Error processing template: ${t.message}`),console.log("\ud83d\udcc4 Template file seems corrupted or incompatible, trying next path...");continue}}}throw console.error("\u274c No se pudo cargar la plantilla desde ninguna ruta"),console.log("\ud83d\udccb Rutas probadas:",this.templatePaths),console.log("\ud83d\udd27 Diagn\xf3stico:"),console.log("   \u2705 El archivo PDF existe en el contenedor"),console.log("   \u2705 Serve est\xe1 funcionando correctamente"),console.log("   \u274c Hay un proxy/nginx intermedio que interfiere"),console.log("\ud83d\udca1 Soluciones:"),console.log("   1. Configurar nginx para servir PDFs correctamente"),console.log("   2. Agregar reglas de proxy para /assets/*"),console.log("   3. Usar el fallback (recomendado por ahora)"),new Error("Proxy/nginx impide acceso al PDF")}catch(e){console.warn("\u274c Failed to load template, using fallback:",e.message),console.log("\ud83c\udfa8 Usando header de respaldo QARPANA (funciona perfectamente)"),this.usingTemplate=!1,this.currentPage=this.pdfDoc.addPage([this.pageWidth,this.pageHeight]),await this.addFallbackHeader()}}async addFallbackHeader(){this.currentPage.drawRectangle({x:0,y:this.pageHeight-60,width:this.pageWidth,height:60,color:(0,r.rgb)(.26,.63,.28)}),this.currentPage.drawText("QARPANA",{x:this.margin,y:this.pageHeight-35,size:20,font:this.boldFont,color:(0,r.rgb)(1,1,1)}),this.currentPage.drawRectangle({x:this.margin,y:this.pageHeight-70,width:this.contentWidth,height:3,color:(0,r.rgb)(.54,.76,.29)}),this.addSimpleFooter()}addSimpleFooter(){this.currentPage.drawRectangle({x:this.margin,y:50,width:this.contentWidth,height:1,color:(0,r.rgb)(.54,.76,.29)}),this.currentPage.drawText("QARPANA - Tel: 3525 640098 - Email: info@qarpana.com.ar",{x:this.margin,y:35,size:8,font:this.font,color:(0,r.rgb)(.4,.4,.4)})}async addNewPage(){try{if(this.usingTemplate&&this.templatePath){const t=await this.verifyTemplateAtPath(this.templatePath);if(t){const e=await r.PDFDocument.load(t.arrayBuffer),[a]=await this.pdfDoc.copyPages(e,[0]);this.currentPage=this.pdfDoc.addPage([this.pageWidth,this.pageHeight]),this.currentPage.drawPage(a,{x:0,y:0,width:this.pageWidth,height:this.pageHeight})}else this.currentPage=this.pdfDoc.addPage([this.pageWidth,this.pageHeight]),await this.addFallbackHeader()}else this.currentPage=this.pdfDoc.addPage([this.pageWidth,this.pageHeight]),await this.addFallbackHeader()}catch(t){console.warn("Error adding new page with template, using fallback:",t),this.currentPage=this.pdfDoc.addPage([this.pageWidth,this.pageHeight]),await this.addFallbackHeader()}this.currentY=this.usingTemplate?600:650}async addReportTitle(t){this.currentPage.drawText("INFORME DE BALANCE HIDRICO",{x:this.margin,y:this.currentY,size:18,font:this.boldFont,color:(0,r.rgb)(.26,.63,.28)}),this.currentY-=30,this.currentPage.drawText(`Campo: ${t}`,{x:this.margin,y:this.currentY,size:14,font:this.boldFont,color:(0,r.rgb)(0,0,0)}),this.currentY-=20,this.currentPage.drawText(`Fecha: ${(0,n.GP)(new Date,"dd/MM/yyyy HH:mm")}`,{x:this.margin,y:this.currentY,size:10,font:this.font,color:(0,r.rgb)(.4,.4,.4)}),this.currentY-=40}async addResumenCirculosFromPage(t){this.currentY<300&&await this.addNewPage(),this.currentPage.drawText("RESUMEN DE CIRCULOS",{x:this.margin,y:this.currentY,size:16,font:this.boldFont,color:(0,r.rgb)(.26,.63,.28)}),this.currentY-=30,await this.captureOnlyLotesCards(t)}async captureOnlyLotesCards(t){try{const a=[".MuiGrid-container > .MuiGrid-item",'[data-testid="lotes-container"] > .MuiGrid-item',".MuiCard-root"];for(const r of a){const a=document.querySelectorAll(r);if(a.length>0&&a.length===t.length){const t=document.createElement("div");t.style.display="flex",t.style.flexWrap="wrap",t.style.gap="16px",t.style.backgroundColor="#ffffff",t.style.padding="20px",a.forEach((e=>{const a=e.cloneNode(!0);a.style.flex="0 0 300px",t.appendChild(a)})),document.body.appendChild(t);try{console.log("Capturando cards de lotes...");const e=await i()(t,{backgroundColor:"#ffffff",scale:1.5,useCORS:!0,allowTaint:!0,logging:!1,width:t.scrollWidth,height:t.scrollHeight});document.body.removeChild(t);const a=e.toDataURL("image/png"),r=this.dataURLtoUint8Array(a),o=await this.pdfDoc.embedPng(r),n=o.scale(.35);return this.currentY-n.height<100&&await this.addNewPage(),this.currentPage.drawImage(o,{x:this.margin,y:this.currentY-n.height,width:n.width,height:n.height}),this.currentY-=n.height+20,void console.log("\u2705 Cards de lotes capturadas exitosamente")}catch(e){throw document.body.contains(t)&&document.body.removeChild(t),e}}}console.log("No se pudieron capturar las cards, usando fallback visual"),await this.createVisualLotesCards(t)}catch(e){console.error("Error capturando cards de lotes:",e),await this.createVisualLotesCards(t)}}async createVisualLotesCards(t){const e=120;let a=0,r=0;for(let i=0;i<t.length;i++){const o=t[i],n=this.margin+175*r,s=this.currentY-135*a;s-e<100?(await this.addNewPage(),a=0,r=0):(await this.drawMaterialCard(o,n,s-e,160,e),r++,r>=3&&(r=0,a++))}const o=Math.ceil(t.length/3);this.currentY-=135*o+20}async drawMaterialCard(t,e,a,o,i){var n,s,c,l;this.currentPage.drawRectangle({x:e+2,y:a-2,width:o,height:i,color:(0,r.rgb)(.9,.9,.9)}),this.currentPage.drawRectangle({x:e,y:a,width:o,height:i,color:(0,r.rgb)(1,1,1),borderColor:(0,r.rgb)(.85,.85,.85),borderWidth:1}),this.currentPage.drawText(t.nombre_lote,{x:e+10,y:a+i-20,size:12,font:this.boldFont,color:(0,r.rgb)(0,0,0)});const h=`${t.especie} - ${t.variedad}`.substring(0,25);this.currentPage.drawText(h,{x:e+10,y:a+i-35,size:8,font:this.font,color:(0,r.rgb)(.4,.4,.4)}),this.currentPage.drawText(`Campana: ${t.campa\u00f1a}`,{x:e+10,y:a+i-48,size:8,font:this.font,color:(0,r.rgb)(.4,.4,.4)}),this.currentPage.drawRectangle({x:e+10,y:a+i-55,width:o-20,height:1,color:(0,r.rgb)(.9,.9,.9)});const d=e+25,g=a+35,u=e+95,m=a+35;this.drawVisualGauge(d,g,20,(null===(n=t.waterData)||void 0===n?void 0:n.porcentajeAu1m)||0,"1 Metro"),this.drawVisualGauge(u,m,20,(null===(s=t.waterData)||void 0===s?void 0:s.porcentajeAu2m)||0,"2 Metros"),this.currentPage.drawText(`${Math.round((null===(c=t.waterData)||void 0===c?void 0:c.aguaUtil1m)||0)} mm`,{x:d-8,y:a+10,size:7,font:this.font,color:(0,r.rgb)(0,0,0)}),this.currentPage.drawText(`${Math.round((null===(l=t.waterData)||void 0===l?void 0:l.aguaUtil2m)||0)} mm`,{x:u-8,y:a+10,size:7,font:this.font,color:(0,r.rgb)(0,0,0)})}drawVisualGauge(t,e,a,o,i){this.currentPage.drawCircle({x:t,y:e,size:a,color:(0,r.rgb)(.9,.9,.9)});const n=this.getColorByPercentage(o),s=a*(o/100);o>0&&this.currentPage.drawCircle({x:t,y:e,size:Math.max(2,s),color:(0,r.rgb)(...n.map((t=>t/255)))}),this.currentPage.drawText(`${Math.round(o)}%`,{x:t-8,y:e-3,size:8,font:this.boldFont,color:(0,r.rgb)(1,1,1)}),this.currentPage.drawText(i,{x:t-15,y:e+a+5,size:7,font:this.font,color:(0,r.rgb)(.25,.66,.96)})}getColorByPercentage(t){return t<=25?[239,68,68]:t<=50?[249,115,22]:t<=75?[255,193,7]:[34,197,94]}async addRecomendaciones(t){if(this.currentY<150&&await this.addNewPage(),this.currentPage.drawText("RECOMENDACIONES",{x:this.margin,y:this.currentY,size:16,font:this.boldFont,color:(0,r.rgb)(.26,.63,.28)}),this.currentY-=25,t&&t.length>0){const e=t[0],a=e.texto||e.descripcion||e.recomendacion||String(e),o=this.splitTextToLines(a,this.contentWidth-20,11);if(this.currentPage.drawRectangle({x:this.margin,y:this.currentY-15*o.length-10,width:this.contentWidth,height:15*o.length+20,color:(0,r.rgb)(.97,.97,.97)}),o.forEach(((t,e)=>{this.currentPage.drawText(t,{x:this.margin+10,y:this.currentY-15*e,size:11,font:this.font,color:(0,r.rgb)(0,0,0)})})),this.currentY-=15*o.length+30,e.fecha_creacion||e.fecha){const t=e.fecha_creacion||e.fecha,a=new Date(t).toLocaleDateString("es-ES");this.currentPage.drawText(`Fecha: ${a}`,{x:this.margin,y:this.currentY,size:9,font:this.font,color:(0,r.rgb)(.4,.4,.4)}),this.currentY-=20}}else this.currentPage.drawText("No hay recomendaciones disponibles para este campo.",{x:this.margin,y:this.currentY,size:10,font:this.font,color:(0,r.rgb)(.6,.6,.6)}),this.currentY-=30}async addLoteDetalleCompleto(t){await this.addNewPage(),this.currentPage.drawText(`DETALLE: ${t.nombre_lote}`,{x:this.margin,y:this.currentY,size:16,font:this.boldFont,color:(0,r.rgb)(.26,.63,.28)}),this.currentY-=40,await this.addEnhancedLoteCards(t),console.log(`\ud83d\udcca Intentando capturar gr\xe1fico del lote: ${t.nombre_lote}`),await this.captureDetailedChartImproved(t)}async captureDetailedChartImproved(t){try{console.log("\ud83d\udcca Intentando capturar gr\xe1fico espec\xedfico del lote:",t.nombre_lote);let e=await this.tryCurrentPageChart();return!!e||(console.log("\ud83d\udccd Estrategia 2: Navegando a la p\xe1gina espec\xedfica del lote"),e=await this.navigateAndCaptureChart(t),!!e||(console.log("\ud83d\udcca Estrategia 3: Creando gr\xe1fico desde datos de simulaci\xf3n"),t.simulationData?(await this.createChartFromData(t.simulationData),!0):(console.log("\u274c Todas las estrategias fallaron, usando fallback"),await this.addChartFallback(),!1)))}catch(e){return console.error("\u274c Error en captura mejorada:",e),await this.addChartFallback(),!1}}async tryCurrentPageChart(){try{console.log("\ud83d\udd0d Buscando gr\xe1ficos en la p\xe1gina actual..."),await new Promise((t=>setTimeout(t,1e3)));const t=Array.from(document.querySelectorAll("canvas"));console.log(`\ud83c\udfa8 Canvas encontrados: ${t.length}`);for(const e of t)if(e.width>400&&e.height>200){console.log("\u2705 Canvas de gr\xe1fico encontrado:",{width:e.width,height:e.height,id:e.id,className:e.className});if(await this.processCanvasImage(e))return!0}return!1}catch(t){return console.error("\u274c Error buscando en p\xe1gina actual:",t),!1}}async navigateAndCaptureChart(t){try{window.location.href;const e=`/simulations?lote=${t.id}&campana=${t.campa\u00f1a}`;console.log(`\ud83e\udded Navegando temporalmente a: ${e}`);const a=document.createElement("iframe");a.style.position="absolute",a.style.left="-9999px",a.style.width="1200px",a.style.height="800px",a.src=e,document.body.appendChild(a),await new Promise((t=>{a.onload=()=>{setTimeout(t,3e3)}}));const r=a.contentDocument||a.contentWindow.document,o=Array.from(r.querySelectorAll("canvas"));console.log(`\ud83c\udfa8 Canvas en iframe: ${o.length}`);let i=!1;for(const t of o)if(t.width>400&&t.height>200&&(console.log("\u2705 Canvas de gr\xe1fico encontrado en iframe"),i=await this.processCanvasImage(t),i))break;return document.body.removeChild(a),i}catch(e){return console.error("\u274c Error navegando a p\xe1gina espec\xedfica:",e),!1}}async createChartFromData(t){try{var e;console.log("\ud83d\udcca Creando gr\xe1fico desde datos de simulaci\xf3n"),this.currentY-250<100&&await this.addNewPage(),this.currentPage.drawText("Balance Hidrico - Ultimos 30 dias",{x:this.margin,y:this.currentY,size:12,font:this.boldFont,color:(0,r.rgb)(.26,.63,.28)}),this.currentY-=25;const a=200,o=this.contentWidth,i=this.currentY-a;this.currentPage.drawRectangle({x:this.margin,y:i,width:o,height:a,color:(0,r.rgb)(.98,.98,.98),borderColor:(0,r.rgb)(.8,.8,.8),borderWidth:1});for(let t=1;t<5;t++){const e=i+a*t/5;this.currentPage.drawLine({start:{x:this.margin,y:e},end:{x:this.margin+o,y:e},thickness:.5,color:(0,r.rgb)(.9,.9,.9)})}const n=Math.min((null===(e=t.fechas)||void 0===e?void 0:e.length)||10,10);for(let t=1;t<n;t++){const e=this.margin+o*t/n;this.currentPage.drawLine({start:{x:e,y:i},end:{x:e,y:i+a},thickness:.5,color:(0,r.rgb)(.9,.9,.9)})}if(t.aguaUtil&&t.aguaUtil.length>0){const e=Math.max(...t.aguaUtil.filter((t=>null!==t&&!isNaN(t)))),n=Math.min(...t.aguaUtil.filter((t=>null!==t&&!isNaN(t)))),s=e-n||100;console.log("\ud83d\udcc8 Dibujando con datos reales:",{puntos:t.aguaUtil.length,max:e,min:n});const c=t.aguaUtil.map(((e,r)=>{if(null===e||isNaN(e))return null;return{x:this.margin+o*r/(t.aguaUtil.length-1),y:i+.2*a+.6*a*((e-n)/s)}})).filter((t=>null!==t));for(let t=0;t<c.length-1;t++)c[t]&&c[t+1]&&this.currentPage.drawLine({start:c[t],end:c[t+1],thickness:2,color:(0,r.rgb)(.15,.18,.54)});if(t.aguaUtilUmbral&&t.aguaUtilUmbral.length>0){const e=t.aguaUtilUmbral[0],c=i+.2*a+.6*a*((e-n)/s);this.currentPage.drawLine({start:{x:this.margin,y:c},end:{x:this.margin+o,y:c},thickness:2,color:(0,r.rgb)(.84,0,0),dashArray:[5,5]})}this.currentPage.drawText(`M\xe1x: ${Math.round(e)} mm`,{x:this.margin+10,y:i+a-20,size:8,font:this.font,color:(0,r.rgb)(.15,.18,.54)}),this.currentPage.drawText(`M\xedn: ${Math.round(n)} mm`,{x:this.margin+10,y:i+10,size:8,font:this.font,color:(0,r.rgb)(.15,.18,.54)})}else this.addSimulatedChart(i,o,a);return this.currentPage.drawText("\u2014 Agua \xdatil",{x:this.margin+o-100,y:i+a-20,size:8,font:this.font,color:(0,r.rgb)(.15,.18,.54)}),this.currentPage.drawText("- - Umbral",{x:this.margin+o-100,y:i+a-35,size:8,font:this.font,color:(0,r.rgb)(.84,0,0)}),this.currentY=i-20,this.addBalanceSummary(t),!0}catch(a){return console.error("\u274c Error creando gr\xe1fico desde datos:",a),!1}}addSimulatedChart(t,e,a){const o=[];for(let r=0;r<30;r++){const i=this.margin+e*r/29,n=-.5*r,s=20*Math.sin(.2*r),c=10*(Math.random()-.5),l=t+.2*a+.6*a*(Math.max(0,120+n+s+c)/150);o.push({x:i,y:l})}for(let n=0;n<o.length-1;n++)this.currentPage.drawLine({start:o[n],end:o[n+1],thickness:2,color:(0,r.rgb)(.15,.18,.54)});const i=t+.4*a;this.currentPage.drawLine({start:{x:this.margin,y:i},end:{x:this.margin+e,y:i},thickness:2,color:(0,r.rgb)(.84,0,0),dashArray:[5,5]})}async processCanvasImage(t){try{const e=t.getContext("2d").getImageData(0,0,t.width,t.height);if(!e.data.some(((t,e)=>e%4!==3&&0!==t&&255!==t)))return console.warn("\u26a0\ufe0f Canvas parece estar vac\xedo o solo con fondo"),!1;console.log("\ud83d\udcca Procesando canvas con contenido v\xe1lido");const a=t.toDataURL("image/png",1);if(a.length<1e3)return console.warn("\u26a0\ufe0f Canvas demasiado peque\xf1o, probablemente vac\xedo"),!1;const o=this.dataURLtoUint8Array(a),i=await this.pdfDoc.embedPng(o),n=i.scale(1),s=this.contentWidth,c=250;let l=Math.min(s/n.width,c/n.height,.8);const h=i.scale(l);this.currentY-h.height<100&&await this.addNewPage(),this.currentPage.drawText("Balance Hidrico - Ultimos 30 dias",{x:this.margin,y:this.currentY,size:12,font:this.boldFont,color:(0,r.rgb)(.26,.63,.28)}),this.currentY-=25;const d=this.margin+(this.contentWidth-h.width)/2;return this.currentPage.drawImage(i,{x:d,y:this.currentY-h.height,width:h.width,height:h.height}),this.currentY-=h.height+20,console.log("\u2705 Gr\xe1fico capturado y a\xf1adido exitosamente"),!0}catch(e){return console.error("\u274c Error procesando imagen del canvas:",e),!1}}async addEnhancedLoteCards(t){var e,a,o,i,n,s,c;const l=[{title:"Cultivo",value:t.especie||"N/A",color:(0,r.rgb)(.26,.63,.28)},{title:"Variedad",value:t.variedad||"N/A",color:(0,r.rgb)(.26,.63,.28)},{title:"Campana",value:t.campa\u00f1a||"N/A",color:(0,r.rgb)(.26,.63,.28)},{title:"Estado Fenologico",value:(null===(e=t.simulationData)||void 0===e?void 0:e.estadoFenologico)||"N/A",color:(0,r.rgb)(.26,.63,.28)}];this.drawCardRow(l,this.currentY,110,50),this.currentY-=70;const h=[{title:"Agua Util Inicial",value:`1m: ${Math.round((null===(a=t.simulationData)||void 0===a?void 0:a.auInicial1m)||0)}mm\n2m: ${Math.round((null===(o=t.simulationData)||void 0===o?void 0:o.auInicial2m)||0)}mm`,color:(0,r.rgb)(.25,.66,.96)},{title:"% Agua Util Actual",value:`1m: ${Math.round((null===(i=t.waterData)||void 0===i?void 0:i.porcentajeAu1m)||0)}%\n2m: ${Math.round((null===(n=t.waterData)||void 0===n?void 0:n.porcentajeAu2m)||0)}%`,color:(0,r.rgb)(.25,.66,.96)},{title:"Proyeccion 7 dias",value:`1m: ${Math.round((null===(s=t.simulationData)||void 0===s?void 0:s.proyeccionAU1mDia8)||0)}mm\n2m: ${Math.round((null===(c=t.simulationData)||void 0===c?void 0:c.proyeccionAU2mDia8)||0)}mm`,color:(0,r.rgb)(.25,.66,.96)}];this.drawCardRow(h,this.currentY,150,60),this.currentY-=80}drawCardRow(t,e,a,o){t.forEach(((t,i)=>{const n=this.margin+i*(a+15);this.currentPage.drawRectangle({x:n+2,y:e-o-2,width:a,height:o,color:(0,r.rgb)(.9,.9,.9)}),this.currentPage.drawRectangle({x:n,y:e-o,width:a,height:o,color:(0,r.rgb)(.98,.98,.98),borderColor:t.color,borderWidth:2}),this.currentPage.drawText(t.title,{x:n+8,y:e-18,size:9,font:this.boldFont,color:t.color});t.value.split("\n").forEach(((t,a)=>{this.currentPage.drawText(t,{x:n+8,y:e-35-12*a,size:10,font:this.font,color:(0,r.rgb)(0,0,0)})}))}))}async addChartFallback(){this.currentPage.drawText("Balance Hidrico - Ultimos 30 dias",{x:this.margin,y:this.currentY,size:12,font:this.boldFont,color:(0,r.rgb)(.26,.63,.28)}),this.currentY-=20;const t=180,e=this.contentWidth;this.currentPage.drawRectangle({x:this.margin,y:this.currentY-t,width:e,height:t,color:(0,r.rgb)(.98,.98,.98),borderColor:(0,r.rgb)(.8,.8,.8),borderWidth:1});for(let i=1;i<5;i++){const a=this.currentY-t*i/5;this.currentPage.drawLine({start:{x:this.margin,y:a},end:{x:this.margin+e,y:a},thickness:.5,color:(0,r.rgb)(.9,.9,.9)})}for(let i=1;i<8;i++){const a=this.margin+e*i/8;this.currentPage.drawLine({start:{x:a,y:this.currentY},end:{x:a,y:this.currentY-t},thickness:.5,color:(0,r.rgb)(.9,.9,.9)})}const a=[];for(let r=0;r<30;r++){const t=this.margin+e*r/29,o=20*Math.sin(.3*r)+15*Math.cos(.2*r),i=this.currentY-54-o;a.push({x:t,y:i})}for(let i=0;i<a.length-1;i++)this.currentPage.drawLine({start:a[i],end:a[i+1],thickness:2,color:(0,r.rgb)(.15,.18,.54)});const o=this.currentY-108;this.currentPage.drawLine({start:{x:this.margin,y:o},end:{x:this.margin+e,y:o},thickness:2,color:(0,r.rgb)(.84,0,0),dashArray:[5,5]}),this.currentPage.drawText("Agua \xdatil",{x:this.margin+10,y:this.currentY-30,size:8,font:this.font,color:(0,r.rgb)(.15,.18,.54)}),this.currentPage.drawText("Umbral",{x:this.margin+10,y:o+5,size:8,font:this.font,color:(0,r.rgb)(.84,0,0)}),this.currentPage.drawText("Gr\xe1fico no disponible en tiempo real",{x:this.margin+e/2-80,y:this.currentY-90,size:10,font:this.font,color:(0,r.rgb)(.6,.6,.6)}),this.currentPage.drawText("Para ver el gr\xe1fico interactivo completo, acceder a la plataforma web",{x:this.margin+10,y:this.currentY-t-15,size:8,font:this.font,color:(0,r.rgb)(.5,.5,.5)}),this.currentY-=210}addBalanceSummary(t){var e;if(!t||this.currentY<120)return;this.currentPage.drawText("Resumen del Periodo:",{x:this.margin,y:this.currentY,size:11,font:this.boldFont,color:(0,r.rgb)(0,0,0)}),this.currentY-=15;[`\u2022 Lluvia efectiva: ${Math.round(t.lluviasEfectivasAcumuladas||0)} mm`,`\u2022 Riego acumulado: ${Math.round(t.riegoAcumulado||0)} mm`,`\u2022 Agua util actual: ${Math.round((null===(e=t.aguaUtil)||void 0===e?void 0:e[t.aguaUtil.length-1])||0)} mm`,`\u2022 % Agua util: ${Math.round(t.porcentajeAguaUtil||0)}%`].forEach((t=>{this.currentPage.drawText(t,{x:this.margin,y:this.currentY,size:9,font:this.font,color:(0,r.rgb)(0,0,0)}),this.currentY-=12})),this.currentY-=10}dataURLtoUint8Array(t){const e=t.split(","),a=atob(e[1]);let r=a.length;const o=new Uint8Array(r);for(;r--;)o[r]=a.charCodeAt(r);return o}splitTextToLines(t,e,a){const r=t.split(" "),o=[];let i="";const n=.6*a,s=Math.floor(e/n);return r.forEach((t=>{(i+t).length<=s?i+=(i?" ":"")+t:(i&&o.push(i),i=t)})),i&&o.push(i),o}}}}]);
//# sourceMappingURL=176.b83d1773.chunk.js.map