{"version":3,"file":"static/js/176.b83d1773.chunk.js","mappings":"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","sources":["components/PDFReportGenerator.js"],"sourcesContent":["import { PDFDocument, rgb, StandardFonts } from 'pdf-lib';\r\nimport html2canvas from 'html2canvas';\r\nimport { format } from 'date-fns';\r\n\r\nclass PDFReportGenerator {\r\n    constructor() {\r\n        this.pdfDoc = null;\r\n        this.currentPage = null;\r\n        this.currentY = 0;\r\n        this.pageHeight = 792; // A4 height in points (72 DPI)\r\n        this.pageWidth = 612; // A4 width in points\r\n        this.margin = 57; // 20mm en points\r\n        this.contentWidth = 498; // A4 width minus margins\r\n        \r\n        // Rutas alternativas para acceder al PDF\r\n        this.templatePaths = [\r\n            // NUEVO: Intentar acceso directo al puerto del contenedor\r\n            `${window.location.protocol}//${window.location.hostname}:3000/assets/hoja_membretada_2.pdf`,\r\n            '/assets/hoja_membretada_2.pdf',\r\n            './assets/hoja_membretada_2.pdf',\r\n            '/public/assets/hoja_membretada_2.pdf',\r\n            './public/assets/hoja_membretada_2.pdf',\r\n            `${window.location.origin}/assets/hoja_membretada_2.pdf`,\r\n            `${window.location.origin}/public/assets/hoja_membretada_2.pdf`\r\n        ];\r\n        \r\n        this.font = null;\r\n        this.boldFont = null;\r\n        this.usingTemplate = false;\r\n    }\r\n\r\n    async generateReport(campoData, lotesData, recomendaciones) {\r\n        try {\r\n            console.log('üöÄ Iniciando generaci√≥n de informe PDF');\r\n            \r\n            // Crear documento PDF\r\n            this.pdfDoc = await PDFDocument.create();\r\n            \r\n            // Cargar fuentes\r\n            this.font = await this.pdfDoc.embedFont(StandardFonts.Helvetica);\r\n            this.boldFont = await this.pdfDoc.embedFont(StandardFonts.HelveticaBold);\r\n            \r\n            // Verificar y cargar plantilla\r\n            await this.loadTemplate();\r\n            \r\n            // Empezar despu√©s del header de la plantilla\r\n            this.currentY = this.usingTemplate ? 600 : 650;\r\n            \r\n            // Agregar t√≠tulo del informe\r\n            await this.addReportTitle(campoData.nombre_campo);\r\n            \r\n            // Esperar a que todos los gr√°ficos se carguen antes de capturar\r\n            console.log('‚è≥ Esperando carga de gr√°ficos...');\r\n            await this.waitForChartsToLoad();\r\n            \r\n            // Capturar y agregar resumen de c√≠rculos (solo las cards)\r\n            await this.addResumenCirculosFromPage(lotesData);\r\n            \r\n            // Agregar recomendaciones\r\n            await this.addRecomendaciones(recomendaciones);\r\n            \r\n            // Agregar informaci√≥n detallada por lote\r\n            for (const lote of lotesData) {\r\n                await this.addLoteDetalleCompleto(lote);\r\n            }\r\n            \r\n            // Generar y descargar el PDF\r\n            const pdfBytes = await this.pdfDoc.save();\r\n            const blob = new Blob([pdfBytes], { type: 'application/pdf' });\r\n            const url = URL.createObjectURL(blob);\r\n            \r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = `Informe_Balance_Hidrico_${campoData.nombre_campo}_${format(new Date(), 'dd-MM-yyyy')}.pdf`;\r\n            document.body.appendChild(a);\r\n            a.click();\r\n            document.body.removeChild(a);\r\n            URL.revokeObjectURL(url);\r\n            \r\n            console.log('‚úÖ Informe PDF generado exitosamente');\r\n            \r\n        } catch (error) {\r\n            console.error('‚ùå Error generando PDF:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // Nueva funci√≥n para esperar a que los gr√°ficos se carguen\r\n    async waitForChartsToLoad() {\r\n        const maxWaitTime = 5000; // 5 segundos m√°ximo\r\n        const checkInterval = 100; // revisar cada 100ms\r\n        let elapsed = 0;\r\n        \r\n        while (elapsed < maxWaitTime) {\r\n            const canvases = document.querySelectorAll('canvas');\r\n            let allLoaded = true;\r\n            \r\n            for (const canvas of canvases) {\r\n                const ctx = canvas.getContext('2d');\r\n                if (ctx && canvas.width > 100 && canvas.height > 100) {\r\n                    // Verificar si el canvas tiene contenido\r\n                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n                    const hasContent = imageData.data.some(pixel => pixel !== 0);\r\n                    \r\n                    if (!hasContent) {\r\n                        allLoaded = false;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            if (allLoaded && canvases.length > 0) {\r\n                console.log('‚úÖ Gr√°ficos cargados correctamente');\r\n                return;\r\n            }\r\n            \r\n            await new Promise(resolve => setTimeout(resolve, checkInterval));\r\n            elapsed += checkInterval;\r\n        }\r\n        \r\n        console.warn('‚ö†Ô∏è Timeout esperando gr√°ficos, continuando...');\r\n    }\r\n\r\n    async verifyTemplateAtPath(templatePath) {\r\n        try {\r\n            console.log(`üîç Verificando plantilla en: ${templatePath}`);\r\n            \r\n            const response = await fetch(templatePath, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Accept': 'application/pdf,*/*',\r\n                    'Cache-Control': 'no-cache'\r\n                },\r\n                // NUEVO: Configuraci√≥n para evitar problemas de CORS\r\n                mode: 'cors',\r\n                credentials: 'same-origin'\r\n            });\r\n            \r\n            if (!response.ok) {\r\n                console.warn(`‚ùå Template not found at: ${templatePath} (${response.status})`);\r\n                return false;\r\n            }\r\n            \r\n            // Verificar el Content-Type\r\n            const contentType = response.headers.get('content-type');\r\n            console.log('üìã Content-Type:', contentType);\r\n            \r\n            // Si es HTML, definitivamente no es nuestro PDF\r\n            if (contentType && contentType.includes('text/html')) {\r\n                console.warn(`‚ùå Received HTML instead of PDF at: ${templatePath}`);\r\n                \r\n                // Diagn√≥stico adicional\r\n                if (templatePath.includes('/assets/')) {\r\n                    console.log('üí° Sugerencia: Problema de proxy/nginx detectado');\r\n                    console.log('üí° El servidor interno funciona, pero hay un proxy intermedio');\r\n                    \r\n                    // Mostrar primera parte del contenido para debug\r\n                    const text = await response.text();\r\n                    console.log('üìÑ Contenido HTML recibido (primeros 200 chars):', text.substring(0, 200));\r\n                }\r\n                \r\n                return false;\r\n            }\r\n            \r\n            const contentLength = response.headers.get('content-length');\r\n            console.log('üìè Content-Length:', contentLength);\r\n            \r\n            // Verificar que el content-length coincida con nuestro PDF (48185 bytes)\r\n            if (contentLength && parseInt(contentLength) !== 48185) {\r\n                console.warn(`‚ö†Ô∏è Content-Length inesperado: ${contentLength}, esperado: 48185`);\r\n                // No retornar false, porque podr√≠a ser una versi√≥n diferente del PDF\r\n            }\r\n            \r\n            if (contentLength === '0') {\r\n                console.warn('‚ùå Template file is empty');\r\n                return false;\r\n            }\r\n            \r\n            const arrayBuffer = await response.arrayBuffer();\r\n            console.log('üì¶ ArrayBuffer size:', arrayBuffer.byteLength, 'bytes');\r\n            \r\n            if (arrayBuffer.byteLength === 0) {\r\n                console.warn('‚ùå Template arrayBuffer is empty');\r\n                return false;\r\n            }\r\n            \r\n            // Si el archivo es muy peque√±o (menos de 1KB), probablemente sea HTML de error\r\n            if (arrayBuffer.byteLength < 1024) {\r\n                console.warn(`‚ùå File too small (${arrayBuffer.byteLength} bytes), probably an error page`);\r\n                \r\n                // Mostrar contenido para diagn√≥stico\r\n                const text = new TextDecoder().decode(arrayBuffer.slice(0, 200));\r\n                console.warn('üìÑ Contenido recibido:', text);\r\n                \r\n                return false;\r\n            }\r\n            \r\n            // Verificar header PDF\r\n            const bytes = new Uint8Array(arrayBuffer);\r\n            const pdfHeader = String.fromCharCode(...bytes.slice(0, 4));\r\n            console.log('üî§ PDF Header:', pdfHeader);\r\n            \r\n            if (pdfHeader !== '%PDF') {\r\n                console.warn(`‚ùå Invalid PDF header: ${pdfHeader}`);\r\n                // Mostrar m√°s informaci√≥n del archivo\r\n                const first50Bytes = String.fromCharCode(...bytes.slice(0, Math.min(50, bytes.length)));\r\n                console.warn('üìÑ Primeros 50 bytes:', first50Bytes);\r\n                return false;\r\n            }\r\n            \r\n            console.log(`‚úÖ Template verified successfully at: ${templatePath}`);\r\n            console.log(`üìä PDF Stats: ${arrayBuffer.byteLength} bytes, Content-Type: ${contentType}`);\r\n            return { valid: true, arrayBuffer };\r\n            \r\n        } catch (error) {\r\n            console.warn(`‚ùå Error verifying template at ${templatePath}:`, error.message);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async loadTemplate() {\r\n        try {\r\n            console.log('üìÑ Intentando cargar plantilla desde m√∫ltiples rutas...');\r\n            \r\n            // Probar cada ruta hasta encontrar una que funcione\r\n            for (const templatePath of this.templatePaths) {\r\n                console.log(`üîç Probando ruta: ${templatePath}`);\r\n                \r\n                const verification = await this.verifyTemplateAtPath(templatePath);\r\n                \r\n                if (verification) {\r\n                    console.log(`‚úÖ Plantilla encontrada en: ${templatePath}`);\r\n                    \r\n                    try {\r\n                        const templateDoc = await PDFDocument.load(verification.arrayBuffer);\r\n                        const templatePages = templateDoc.getPages();\r\n                        \r\n                        if (templatePages.length === 0) {\r\n                            console.warn('‚ùå Template has no pages');\r\n                            continue;\r\n                        }\r\n                        \r\n                        // Verificar que la primera p√°gina sea v√°lida\r\n                        const firstPage = templatePages[0];\r\n                        if (!firstPage) {\r\n                            console.warn('‚ùå First page is invalid');\r\n                            continue;\r\n                        }\r\n                        \r\n                        // Copiar la primera p√°gina de la plantilla\r\n                        const [templatePage] = await this.pdfDoc.copyPages(templateDoc, [0]);\r\n                        \r\n                        // Verificar que la p√°gina copiada sea v√°lida\r\n                        if (!templatePage) {\r\n                            console.warn('‚ùå Failed to copy template page');\r\n                            continue;\r\n                        }\r\n                        \r\n                        this.currentPage = this.pdfDoc.addPage([this.pageWidth, this.pageHeight]);\r\n                        \r\n                        // Dibujar la plantilla en la p√°gina actual\r\n                        this.currentPage.drawPage(templatePage, {\r\n                            x: 0,\r\n                            y: 0,\r\n                            width: this.pageWidth,\r\n                            height: this.pageHeight,\r\n                        });\r\n                        \r\n                        this.usingTemplate = true;\r\n                        this.templatePath = templatePath; // Guardar la ruta que funcion√≥\r\n                        console.log('‚úÖ Template loaded successfully');\r\n                        return;\r\n                        \r\n                    } catch (templateError) {\r\n                        console.warn(`‚ùå Error processing template: ${templateError.message}`);\r\n                        console.log('üìÑ Template file seems corrupted or incompatible, trying next path...');\r\n                        continue; // Intentar siguiente ruta\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // Si llegamos aqu√≠, ninguna ruta funcion√≥\r\n            console.error('‚ùå No se pudo cargar la plantilla desde ninguna ruta');\r\n            console.log('üìã Rutas probadas:', this.templatePaths);\r\n            console.log('üîß Diagn√≥stico:');\r\n            console.log('   ‚úÖ El archivo PDF existe en el contenedor');\r\n            console.log('   ‚úÖ Serve est√° funcionando correctamente');\r\n            console.log('   ‚ùå Hay un proxy/nginx intermedio que interfiere');\r\n            console.log('üí° Soluciones:');\r\n            console.log('   1. Configurar nginx para servir PDFs correctamente');\r\n            console.log('   2. Agregar reglas de proxy para /assets/*');\r\n            console.log('   3. Usar el fallback (recomendado por ahora)');\r\n            \r\n            throw new Error('Proxy/nginx impide acceso al PDF');\r\n            \r\n        } catch (error) {\r\n            console.warn('‚ùå Failed to load template, using fallback:', error.message);\r\n            console.log('üé® Usando header de respaldo QARPANA (funciona perfectamente)');\r\n            this.usingTemplate = false;\r\n            this.currentPage = this.pdfDoc.addPage([this.pageWidth, this.pageHeight]);\r\n            await this.addFallbackHeader();\r\n        }\r\n    }\r\n\r\n    async addFallbackHeader() {\r\n        // Header de respaldo estilo QARPANA\r\n        this.currentPage.drawRectangle({\r\n            x: 0,\r\n            y: this.pageHeight - 60,\r\n            width: this.pageWidth,\r\n            height: 60,\r\n            color: rgb(0.26, 0.63, 0.28), // Verde QARPANA\r\n        });\r\n        \r\n        this.currentPage.drawText('QARPANA', {\r\n            x: this.margin,\r\n            y: this.pageHeight - 35,\r\n            size: 20,\r\n            font: this.boldFont,\r\n            color: rgb(1, 1, 1),\r\n        });\r\n\r\n        // L√≠nea decorativa verde\r\n        this.currentPage.drawRectangle({\r\n            x: this.margin,\r\n            y: this.pageHeight - 70,\r\n            width: this.contentWidth,\r\n            height: 3,\r\n            color: rgb(0.54, 0.76, 0.29),\r\n        });\r\n\r\n        // Footer\r\n        this.addSimpleFooter();\r\n    }\r\n\r\n    addSimpleFooter() {\r\n        const footerY = 50;\r\n        \r\n        // L√≠nea separadora\r\n        this.currentPage.drawRectangle({\r\n            x: this.margin,\r\n            y: footerY,\r\n            width: this.contentWidth,\r\n            height: 1,\r\n            color: rgb(0.54, 0.76, 0.29),\r\n        });\r\n        \r\n        // Informaci√≥n de contacto\r\n        this.currentPage.drawText('QARPANA - Tel: 3525 640098 - Email: info@qarpana.com.ar', {\r\n            x: this.margin,\r\n            y: footerY - 15,\r\n            size: 8,\r\n            font: this.font,\r\n            color: rgb(0.4, 0.4, 0.4),\r\n        });\r\n    }\r\n\r\n    async addNewPage() {\r\n        try {\r\n            if (this.usingTemplate && this.templatePath) {\r\n                const verification = await this.verifyTemplateAtPath(this.templatePath);\r\n                if (verification) {\r\n                    const templateDoc = await PDFDocument.load(verification.arrayBuffer);\r\n                    const [templatePage] = await this.pdfDoc.copyPages(templateDoc, [0]);\r\n                    \r\n                    this.currentPage = this.pdfDoc.addPage([this.pageWidth, this.pageHeight]);\r\n                    this.currentPage.drawPage(templatePage, {\r\n                        x: 0,\r\n                        y: 0,\r\n                        width: this.pageWidth,\r\n                        height: this.pageHeight,\r\n                    });\r\n                } else {\r\n                    this.currentPage = this.pdfDoc.addPage([this.pageWidth, this.pageHeight]);\r\n                    await this.addFallbackHeader();\r\n                }\r\n            } else {\r\n                this.currentPage = this.pdfDoc.addPage([this.pageWidth, this.pageHeight]);\r\n                await this.addFallbackHeader();\r\n            }\r\n        } catch (error) {\r\n            console.warn('Error adding new page with template, using fallback:', error);\r\n            this.currentPage = this.pdfDoc.addPage([this.pageWidth, this.pageHeight]);\r\n            await this.addFallbackHeader();\r\n        }\r\n        \r\n        this.currentY = this.usingTemplate ? 600 : 650;\r\n    }\r\n\r\n    async addReportTitle(nombreCampo) {\r\n        this.currentPage.drawText('INFORME DE BALANCE HIDRICO', {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 18,\r\n            font: this.boldFont,\r\n            color: rgb(0.26, 0.63, 0.28),\r\n        });\r\n        \r\n        this.currentY -= 30;\r\n        \r\n        this.currentPage.drawText(`Campo: ${nombreCampo}`, {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 14,\r\n            font: this.boldFont,\r\n            color: rgb(0, 0, 0),\r\n        });\r\n        \r\n        this.currentY -= 20;\r\n        \r\n        this.currentPage.drawText(`Fecha: ${format(new Date(), 'dd/MM/yyyy HH:mm')}`, {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 10,\r\n            font: this.font,\r\n            color: rgb(0.4, 0.4, 0.4),\r\n        });\r\n        \r\n        this.currentY -= 40;\r\n    }\r\n\r\n    async addResumenCirculosFromPage(lotesData) {\r\n        // Verificar si necesitamos nueva p√°gina\r\n        if (this.currentY < 300) {\r\n            await this.addNewPage();\r\n        }\r\n        \r\n        // T√≠tulo secci√≥n\r\n        this.currentPage.drawText('RESUMEN DE CIRCULOS', {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 16,\r\n            font: this.boldFont,\r\n            color: rgb(0.26, 0.63, 0.28),\r\n        });\r\n        \r\n        this.currentY -= 30;\r\n        \r\n        // Capturar SOLO las cards, no el selector\r\n        await this.captureOnlyLotesCards(lotesData);\r\n    }\r\n\r\n    async captureOnlyLotesCards(lotesData) {\r\n        try {\r\n            // Buscar espec√≠ficamente el grid de cards, evitando el selector\r\n            const selectors = [\r\n                '.MuiGrid-container > .MuiGrid-item', // Los items individuales\r\n                '[data-testid=\"lotes-container\"] > .MuiGrid-item',\r\n                '.MuiCard-root' // Las cards directamente\r\n            ];\r\n            \r\n            let lotesCards = null;\r\n            \r\n            for (const selector of selectors) {\r\n                const elements = document.querySelectorAll(selector);\r\n                if (elements.length > 0 && elements.length === lotesData.length) {\r\n                    // Crear un contenedor temporal solo con las cards\r\n                    const tempContainer = document.createElement('div');\r\n                    tempContainer.style.display = 'flex';\r\n                    tempContainer.style.flexWrap = 'wrap';\r\n                    tempContainer.style.gap = '16px';\r\n                    tempContainer.style.backgroundColor = '#ffffff';\r\n                    tempContainer.style.padding = '20px';\r\n                    \r\n                    // Clonar y agregar las cards al contenedor temporal\r\n                    elements.forEach(card => {\r\n                        const clone = card.cloneNode(true);\r\n                        clone.style.flex = '0 0 300px'; // Tama√±o fijo para las cards\r\n                        tempContainer.appendChild(clone);\r\n                    });\r\n                    \r\n                    // Agregar temporalmente al DOM\r\n                    document.body.appendChild(tempContainer);\r\n                    \r\n                    try {\r\n                        console.log('Capturando cards de lotes...');\r\n                        \r\n                        const canvas = await html2canvas(tempContainer, {\r\n                            backgroundColor: '#ffffff',\r\n                            scale: 1.5,\r\n                            useCORS: true,\r\n                            allowTaint: true,\r\n                            logging: false,\r\n                            width: tempContainer.scrollWidth,\r\n                            height: tempContainer.scrollHeight,\r\n                        });\r\n                        \r\n                        // Remover el contenedor temporal\r\n                        document.body.removeChild(tempContainer);\r\n                        \r\n                        // Convertir y agregar al PDF\r\n                        const imgData = canvas.toDataURL('image/png');\r\n                        const imgBytes = this.dataURLtoUint8Array(imgData);\r\n                        \r\n                        const image = await this.pdfDoc.embedPng(imgBytes);\r\n                        const imageDims = image.scale(0.35); // Escalar para que entre bien\r\n                        \r\n                        // Verificar que la imagen entre en la p√°gina\r\n                        if (this.currentY - imageDims.height < 100) {\r\n                            await this.addNewPage();\r\n                        }\r\n                        \r\n                        // Dibujar imagen en el PDF\r\n                        this.currentPage.drawImage(image, {\r\n                            x: this.margin,\r\n                            y: this.currentY - imageDims.height,\r\n                            width: imageDims.width,\r\n                            height: imageDims.height,\r\n                        });\r\n                        \r\n                        this.currentY -= imageDims.height + 20;\r\n                        console.log('‚úÖ Cards de lotes capturadas exitosamente');\r\n                        return;\r\n                        \r\n                    } catch (error) {\r\n                        // Remover el contenedor temporal si hay error\r\n                        if (document.body.contains(tempContainer)) {\r\n                            document.body.removeChild(tempContainer);\r\n                        }\r\n                        throw error;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // Si no se pudieron capturar, usar fallback visual mejorado\r\n            console.log('No se pudieron capturar las cards, usando fallback visual');\r\n            await this.createVisualLotesCards(lotesData);\r\n            \r\n        } catch (error) {\r\n            console.error('Error capturando cards de lotes:', error);\r\n            await this.createVisualLotesCards(lotesData);\r\n        }\r\n    }\r\n\r\n    async createVisualLotesCards(lotesData) {\r\n        // Crear cards visuales similares a las de la p√°gina\r\n        const cardWidth = 160;\r\n        const cardHeight = 120;\r\n        const spacing = 15;\r\n        const cardsPerRow = 3;\r\n        \r\n        let currentRow = 0;\r\n        let currentCol = 0;\r\n        \r\n        for (let i = 0; i < lotesData.length; i++) {\r\n            const lote = lotesData[i];\r\n            \r\n            // Calcular posici√≥n\r\n            const x = this.margin + (currentCol * (cardWidth + spacing));\r\n            const y = this.currentY - (currentRow * (cardHeight + spacing));\r\n            \r\n            // Verificar si necesitamos nueva p√°gina\r\n            if (y - cardHeight < 100) {\r\n                await this.addNewPage();\r\n                currentRow = 0;\r\n                currentCol = 0;\r\n                continue;\r\n            }\r\n            \r\n            // Dibujar card estilo Material-UI\r\n            await this.drawMaterialCard(lote, x, y - cardHeight, cardWidth, cardHeight);\r\n            \r\n            // Actualizar posici√≥n\r\n            currentCol++;\r\n            if (currentCol >= cardsPerRow) {\r\n                currentCol = 0;\r\n                currentRow++;\r\n            }\r\n        }\r\n        \r\n        // Actualizar currentY\r\n        const totalRows = Math.ceil(lotesData.length / cardsPerRow);\r\n        this.currentY -= (totalRows * (cardHeight + spacing)) + 20;\r\n    }\r\n\r\n    async drawMaterialCard(lote, x, y, width, height) {\r\n        // Fondo de la card con sombra simulada\r\n        this.currentPage.drawRectangle({\r\n            x: x + 2,\r\n            y: y - 2,\r\n            width: width,\r\n            height: height,\r\n            color: rgb(0.9, 0.9, 0.9), // Sombra\r\n        });\r\n        \r\n        this.currentPage.drawRectangle({\r\n            x: x,\r\n            y: y,\r\n            width: width,\r\n            height: height,\r\n            color: rgb(1, 1, 1), // Fondo blanco\r\n            borderColor: rgb(0.85, 0.85, 0.85),\r\n            borderWidth: 1,\r\n        });\r\n        \r\n        // T√≠tulo del lote\r\n        this.currentPage.drawText(lote.nombre_lote, {\r\n            x: x + 10,\r\n            y: y + height - 20,\r\n            size: 12,\r\n            font: this.boldFont,\r\n            color: rgb(0, 0, 0),\r\n        });\r\n        \r\n        // Subt√≠tulo (cultivo - variedad)\r\n        const subtitulo = `${lote.especie} - ${lote.variedad}`.substring(0, 25);\r\n        this.currentPage.drawText(subtitulo, {\r\n            x: x + 10,\r\n            y: y + height - 35,\r\n            size: 8,\r\n            font: this.font,\r\n            color: rgb(0.4, 0.4, 0.4),\r\n        });\r\n        \r\n        // Campa√±a\r\n        this.currentPage.drawText(`Campana: ${lote.campa√±a}`, {\r\n            x: x + 10,\r\n            y: y + height - 48,\r\n            size: 8,\r\n            font: this.font,\r\n            color: rgb(0.4, 0.4, 0.4),\r\n        });\r\n        \r\n        // L√≠nea separadora\r\n        this.currentPage.drawRectangle({\r\n            x: x + 10,\r\n            y: y + height - 55,\r\n            width: width - 20,\r\n            height: 1,\r\n            color: rgb(0.9, 0.9, 0.9),\r\n        });\r\n        \r\n        // Gauges visuales\r\n        const gauge1X = x + 25;\r\n        const gauge1Y = y + 35;\r\n        const gauge2X = x + 95;\r\n        const gauge2Y = y + 35;\r\n        \r\n        // Gauge 1 Metro\r\n        this.drawVisualGauge(\r\n            gauge1X, gauge1Y, 20,\r\n            lote.waterData?.porcentajeAu1m || 0,\r\n            '1 Metro'\r\n        );\r\n        \r\n        // Gauge 2 Metros  \r\n        this.drawVisualGauge(\r\n            gauge2X, gauge2Y, 20,\r\n            lote.waterData?.porcentajeAu2m || 0,\r\n            '2 Metros'\r\n        );\r\n        \r\n        // Valores en mm\r\n        this.currentPage.drawText(`${Math.round(lote.waterData?.aguaUtil1m || 0)} mm`, {\r\n            x: gauge1X - 8,\r\n            y: y + 10,\r\n            size: 7,\r\n            font: this.font,\r\n            color: rgb(0, 0, 0),\r\n        });\r\n        \r\n        this.currentPage.drawText(`${Math.round(lote.waterData?.aguaUtil2m || 0)} mm`, {\r\n            x: gauge2X - 8,\r\n            y: y + 10,\r\n            size: 7,\r\n            font: this.font,\r\n            color: rgb(0, 0, 0),\r\n        });\r\n    }\r\n\r\n    drawVisualGauge(centerX, centerY, radius, percentage, label) {\r\n        // Fondo del gauge\r\n        this.currentPage.drawCircle({\r\n            x: centerX,\r\n            y: centerY,\r\n            size: radius,\r\n            color: rgb(0.9, 0.9, 0.9),\r\n        });\r\n        \r\n        // Color seg√∫n porcentaje\r\n        const color = this.getColorByPercentage(percentage);\r\n        \r\n        // C√≠rculo de progreso (simplificado)\r\n        const progressRadius = radius * (percentage / 100);\r\n        if (percentage > 0) {\r\n            this.currentPage.drawCircle({\r\n                x: centerX,\r\n                y: centerY,\r\n                size: Math.max(2, progressRadius),\r\n                color: rgb(...color.map(c => c / 255)),\r\n            });\r\n        }\r\n        \r\n        // Texto del porcentaje\r\n        this.currentPage.drawText(`${Math.round(percentage)}%`, {\r\n            x: centerX - 8,\r\n            y: centerY - 3,\r\n            size: 8,\r\n            font: this.boldFont,\r\n            color: rgb(1, 1, 1),\r\n        });\r\n        \r\n        // Label\r\n        this.currentPage.drawText(label, {\r\n            x: centerX - 15,\r\n            y: centerY + radius + 5,\r\n            size: 7,\r\n            font: this.font,\r\n            color: rgb(0.25, 0.66, 0.96),\r\n        });\r\n    }\r\n\r\n    getColorByPercentage(percentage) {\r\n        if (percentage <= 25) return [239, 68, 68]; // Rojo\r\n        if (percentage <= 50) return [249, 115, 22]; // Naranja\r\n        if (percentage <= 75) return [255, 193, 7]; // Amarillo\r\n        return [34, 197, 94]; // Verde\r\n    }\r\n\r\n    async addRecomendaciones(recomendaciones) {\r\n        if (this.currentY < 150) {\r\n            await this.addNewPage();\r\n        }\r\n        \r\n        this.currentPage.drawText('RECOMENDACIONES', {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 16,\r\n            font: this.boldFont,\r\n            color: rgb(0.26, 0.63, 0.28),\r\n        });\r\n        \r\n        this.currentY -= 25;\r\n        \r\n        if (recomendaciones && recomendaciones.length > 0) {\r\n            const recomendacion = recomendaciones[0];\r\n            const texto = recomendacion.texto || \r\n                         recomendacion.descripcion || \r\n                         recomendacion.recomendacion || \r\n                         String(recomendacion);\r\n            \r\n            // Dividir texto en l√≠neas\r\n            const lines = this.splitTextToLines(texto, this.contentWidth - 20, 11);\r\n            \r\n            // Dibujar fondo para la recomendaci√≥n\r\n            this.currentPage.drawRectangle({\r\n                x: this.margin,\r\n                y: this.currentY - (lines.length * 15) - 10,\r\n                width: this.contentWidth,\r\n                height: (lines.length * 15) + 20,\r\n                color: rgb(0.97, 0.97, 0.97),\r\n            });\r\n            \r\n            // Dibujar texto\r\n            lines.forEach((line, index) => {\r\n                this.currentPage.drawText(line, {\r\n                    x: this.margin + 10,\r\n                    y: this.currentY - (index * 15),\r\n                    size: 11,\r\n                    font: this.font,\r\n                    color: rgb(0, 0, 0),\r\n                });\r\n            });\r\n            \r\n            this.currentY -= (lines.length * 15) + 30;\r\n            \r\n            // Fecha si est√° disponible\r\n            if (recomendacion.fecha_creacion || recomendacion.fecha) {\r\n                const fecha = recomendacion.fecha_creacion || recomendacion.fecha;\r\n                const fechaFormateada = new Date(fecha).toLocaleDateString('es-ES');\r\n                \r\n                this.currentPage.drawText(`Fecha: ${fechaFormateada}`, {\r\n                    x: this.margin,\r\n                    y: this.currentY,\r\n                    size: 9,\r\n                    font: this.font,\r\n                    color: rgb(0.4, 0.4, 0.4),\r\n                });\r\n                \r\n                this.currentY -= 20;\r\n            }\r\n        } else {\r\n            this.currentPage.drawText('No hay recomendaciones disponibles para este campo.', {\r\n                x: this.margin,\r\n                y: this.currentY,\r\n                size: 10,\r\n                font: this.font,\r\n                color: rgb(0.6, 0.6, 0.6),\r\n            });\r\n            this.currentY -= 30;\r\n        }\r\n    }\r\n\r\n    async addLoteDetalleCompleto(lote) {\r\n        // Nueva p√°gina para cada lote\r\n        await this.addNewPage();\r\n        \r\n        // T√≠tulo del lote\r\n        this.currentPage.drawText(`DETALLE: ${lote.nombre_lote}`, {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 16,\r\n            font: this.boldFont,\r\n            color: rgb(0.26, 0.63, 0.28),\r\n        });\r\n        \r\n        this.currentY -= 40;\r\n        \r\n        // Cards de informaci√≥n del lote con mejor formato\r\n        await this.addEnhancedLoteCards(lote);\r\n        \r\n        // NUEVO: Intentar capturar gr√°fico con m√©todo mejorado\r\n        console.log(`üìä Intentando capturar gr√°fico del lote: ${lote.nombre_lote}`);\r\n        await this.captureDetailedChartImproved(lote);\r\n    }\r\n\r\n    async captureDetailedChartImproved(lote) {\r\n        try {\r\n            console.log('üìä Intentando capturar gr√°fico espec√≠fico del lote:', lote.nombre_lote);\r\n            \r\n            // ESTRATEGIA 1: Buscar gr√°ficos en la p√°gina actual\r\n            let success = await this.tryCurrentPageChart();\r\n            if (success) return true;\r\n            \r\n            // ESTRATEGIA 2: Navegar espec√≠ficamente al lote\r\n            console.log('üìç Estrategia 2: Navegando a la p√°gina espec√≠fica del lote');\r\n            success = await this.navigateAndCaptureChart(lote);\r\n            if (success) return true;\r\n            \r\n            // ESTRATEGIA 3: Usar datos de simulaci√≥n para crear gr√°fico\r\n            console.log('üìä Estrategia 3: Creando gr√°fico desde datos de simulaci√≥n');\r\n            if (lote.simulationData) {\r\n                await this.createChartFromData(lote.simulationData);\r\n                return true;\r\n            }\r\n            \r\n            // FALLBACK: Gr√°fico simulado\r\n            console.log('‚ùå Todas las estrategias fallaron, usando fallback');\r\n            await this.addChartFallback();\r\n            return false;\r\n            \r\n        } catch (error) {\r\n            console.error('‚ùå Error en captura mejorada:', error);\r\n            await this.addChartFallback();\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async tryCurrentPageChart() {\r\n        try {\r\n            console.log('üîç Buscando gr√°ficos en la p√°gina actual...');\r\n            \r\n            // Esperar un momento\r\n            await new Promise(resolve => setTimeout(resolve, 1000));\r\n            \r\n            const allCanvases = Array.from(document.querySelectorAll('canvas'));\r\n            console.log(`üé® Canvas encontrados: ${allCanvases.length}`);\r\n            \r\n            for (const canvas of allCanvases) {\r\n                if (canvas.width > 400 && canvas.height > 200) {\r\n                    console.log('‚úÖ Canvas de gr√°fico encontrado:', {\r\n                        width: canvas.width,\r\n                        height: canvas.height,\r\n                        id: canvas.id,\r\n                        className: canvas.className\r\n                    });\r\n                    \r\n                    const success = await this.processCanvasImage(canvas);\r\n                    if (success) return true;\r\n                }\r\n            }\r\n            \r\n            return false;\r\n        } catch (error) {\r\n            console.error('‚ùå Error buscando en p√°gina actual:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async navigateAndCaptureChart(lote) {\r\n        try {\r\n            // Guardar URL actual\r\n            const originalUrl = window.location.href;\r\n            const targetUrl = `/simulations?lote=${lote.id}&campana=${lote.campa√±a}`;\r\n            \r\n            console.log(`üß≠ Navegando temporalmente a: ${targetUrl}`);\r\n            \r\n            // Crear iframe invisible para cargar la p√°gina del gr√°fico\r\n            const iframe = document.createElement('iframe');\r\n            iframe.style.position = 'absolute';\r\n            iframe.style.left = '-9999px';\r\n            iframe.style.width = '1200px';\r\n            iframe.style.height = '800px';\r\n            iframe.src = targetUrl;\r\n            document.body.appendChild(iframe);\r\n            \r\n            // Esperar a que cargue\r\n            await new Promise((resolve) => {\r\n                iframe.onload = () => {\r\n                    setTimeout(resolve, 3000); // Esperar 3 segundos para que se renderice el gr√°fico\r\n                };\r\n            });\r\n            \r\n            // Buscar canvas en el iframe\r\n            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;\r\n            const canvases = Array.from(iframeDoc.querySelectorAll('canvas'));\r\n            \r\n            console.log(`üé® Canvas en iframe: ${canvases.length}`);\r\n            \r\n            let success = false;\r\n            for (const canvas of canvases) {\r\n                if (canvas.width > 400 && canvas.height > 200) {\r\n                    console.log('‚úÖ Canvas de gr√°fico encontrado en iframe');\r\n                    success = await this.processCanvasImage(canvas);\r\n                    if (success) break;\r\n                }\r\n            }\r\n            \r\n            // Limpiar iframe\r\n            document.body.removeChild(iframe);\r\n            \r\n            return success;\r\n            \r\n        } catch (error) {\r\n            console.error('‚ùå Error navegando a p√°gina espec√≠fica:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async createChartFromData(simulationData) {\r\n        try {\r\n            console.log('üìä Creando gr√°fico desde datos de simulaci√≥n');\r\n            \r\n            // Verificar si necesitamos nueva p√°gina\r\n            if (this.currentY - 250 < 100) {\r\n                await this.addNewPage();\r\n            }\r\n            \r\n            // T√≠tulo del gr√°fico\r\n            this.currentPage.drawText('Balance Hidrico - Ultimos 30 dias', {\r\n                x: this.margin,\r\n                y: this.currentY,\r\n                size: 12,\r\n                font: this.boldFont,\r\n                color: rgb(0.26, 0.63, 0.28),\r\n            });\r\n            \r\n            this.currentY -= 25;\r\n            \r\n            const chartHeight = 200;\r\n            const chartWidth = this.contentWidth;\r\n            const chartStartY = this.currentY - chartHeight;\r\n            \r\n            // Fondo del gr√°fico\r\n            this.currentPage.drawRectangle({\r\n                x: this.margin,\r\n                y: chartStartY,\r\n                width: chartWidth,\r\n                height: chartHeight,\r\n                color: rgb(0.98, 0.98, 0.98),\r\n                borderColor: rgb(0.8, 0.8, 0.8),\r\n                borderWidth: 1,\r\n            });\r\n            \r\n            // Grid horizontal\r\n            for (let i = 1; i < 5; i++) {\r\n                const y = chartStartY + (chartHeight * i / 5);\r\n                this.currentPage.drawLine({\r\n                    start: { x: this.margin, y: y },\r\n                    end: { x: this.margin + chartWidth, y: y },\r\n                    thickness: 0.5,\r\n                    color: rgb(0.9, 0.9, 0.9),\r\n                });\r\n            }\r\n            \r\n            // Grid vertical\r\n            const numVerticalLines = Math.min(simulationData.fechas?.length || 10, 10);\r\n            for (let i = 1; i < numVerticalLines; i++) {\r\n                const x = this.margin + (chartWidth * i / numVerticalLines);\r\n                this.currentPage.drawLine({\r\n                    start: { x: x, y: chartStartY },\r\n                    end: { x: x, y: chartStartY + chartHeight },\r\n                    thickness: 0.5,\r\n                    color: rgb(0.9, 0.9, 0.9),\r\n                });\r\n            }\r\n            \r\n            // Dibujar datos reales si est√°n disponibles\r\n            if (simulationData.aguaUtil && simulationData.aguaUtil.length > 0) {\r\n                const maxValue = Math.max(...simulationData.aguaUtil.filter(v => v !== null && !isNaN(v)));\r\n                const minValue = Math.min(...simulationData.aguaUtil.filter(v => v !== null && !isNaN(v)));\r\n                const range = maxValue - minValue || 100;\r\n                \r\n                console.log('üìà Dibujando con datos reales:', {\r\n                    puntos: simulationData.aguaUtil.length,\r\n                    max: maxValue,\r\n                    min: minValue\r\n                });\r\n                \r\n                // L√≠nea de agua √∫til con datos reales\r\n                const points = simulationData.aguaUtil.map((value, index) => {\r\n                    if (value === null || isNaN(value)) return null;\r\n                    \r\n                    const x = this.margin + (chartWidth * index / (simulationData.aguaUtil.length - 1));\r\n                    const normalizedValue = (value - minValue) / range;\r\n                    const y = chartStartY + chartHeight * 0.2 + (chartHeight * 0.6 * normalizedValue);\r\n                    \r\n                    return { x, y };\r\n                }).filter(p => p !== null);\r\n                \r\n                // Dibujar l√≠nea de agua √∫til\r\n                for (let i = 0; i < points.length - 1; i++) {\r\n                    if (points[i] && points[i + 1]) {\r\n                        this.currentPage.drawLine({\r\n                            start: points[i],\r\n                            end: points[i + 1],\r\n                            thickness: 2,\r\n                            color: rgb(0.15, 0.18, 0.54),\r\n                        });\r\n                    }\r\n                }\r\n                \r\n                // L√≠nea de umbral si existe\r\n                if (simulationData.aguaUtilUmbral && simulationData.aguaUtilUmbral.length > 0) {\r\n                    const umbralValue = simulationData.aguaUtilUmbral[0];\r\n                    const umbralNormalized = (umbralValue - minValue) / range;\r\n                    const umbralY = chartStartY + chartHeight * 0.2 + (chartHeight * 0.6 * umbralNormalized);\r\n                    \r\n                    this.currentPage.drawLine({\r\n                        start: { x: this.margin, y: umbralY },\r\n                        end: { x: this.margin + chartWidth, y: umbralY },\r\n                        thickness: 2,\r\n                        color: rgb(0.84, 0, 0),\r\n                        dashArray: [5, 5],\r\n                    });\r\n                }\r\n                \r\n                // Etiquetas con valores reales\r\n                this.currentPage.drawText(`M√°x: ${Math.round(maxValue)} mm`, {\r\n                    x: this.margin + 10,\r\n                    y: chartStartY + chartHeight - 20,\r\n                    size: 8,\r\n                    font: this.font,\r\n                    color: rgb(0.15, 0.18, 0.54),\r\n                });\r\n                \r\n                this.currentPage.drawText(`M√≠n: ${Math.round(minValue)} mm`, {\r\n                    x: this.margin + 10,\r\n                    y: chartStartY + 10,\r\n                    size: 8,\r\n                    font: this.font,\r\n                    color: rgb(0.15, 0.18, 0.54),\r\n                });\r\n                \r\n            } else {\r\n                // Si no hay datos, usar gr√°fico simulado\r\n                this.addSimulatedChart(chartStartY, chartWidth, chartHeight);\r\n            }\r\n            \r\n            // Leyenda (usando caracteres compatibles con WinAnsi)\r\n            this.currentPage.drawText('‚Äî Agua √ötil', {\r\n                x: this.margin + chartWidth - 100,\r\n                y: chartStartY + chartHeight - 20,\r\n                size: 8,\r\n                font: this.font,\r\n                color: rgb(0.15, 0.18, 0.54),\r\n            });\r\n            \r\n            this.currentPage.drawText('- - Umbral', {\r\n                x: this.margin + chartWidth - 100,\r\n                y: chartStartY + chartHeight - 35,\r\n                size: 8,\r\n                font: this.font,\r\n                color: rgb(0.84, 0, 0),\r\n            });\r\n            \r\n            this.currentY = chartStartY - 20;\r\n            \r\n            // Agregar resumen de datos\r\n            this.addBalanceSummary(simulationData);\r\n            \r\n            return true;\r\n            \r\n        } catch (error) {\r\n            console.error('‚ùå Error creando gr√°fico desde datos:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    addSimulatedChart(chartStartY, chartWidth, chartHeight) {\r\n        // Crear datos simulados m√°s realistas\r\n        const points = [];\r\n        const numPoints = 30;\r\n        let baseValue = 120; // Valor base en mm\r\n        \r\n        for (let i = 0; i < numPoints; i++) {\r\n            const x = this.margin + (chartWidth * i / (numPoints - 1));\r\n            \r\n            // Simular variaci√≥n m√°s realista\r\n            const trend = -0.5 * i; // Tendencia descendente ligera\r\n            const seasonal = 20 * Math.sin(i * 0.2); // Variaci√≥n estacional\r\n            const random = (Math.random() - 0.5) * 10; // Variaci√≥n aleatoria\r\n            \r\n            const value = Math.max(0, baseValue + trend + seasonal + random);\r\n            const y = chartStartY + chartHeight * 0.2 + (chartHeight * 0.6 * (value / 150));\r\n            \r\n            points.push({ x, y });\r\n        }\r\n        \r\n        // Dibujar l√≠nea simulada\r\n        for (let i = 0; i < points.length - 1; i++) {\r\n            this.currentPage.drawLine({\r\n                start: points[i],\r\n                end: points[i + 1],\r\n                thickness: 2,\r\n                color: rgb(0.15, 0.18, 0.54),\r\n            });\r\n        }\r\n        \r\n        // L√≠nea de umbral simulada\r\n        const umbralY = chartStartY + chartHeight * 0.4;\r\n        this.currentPage.drawLine({\r\n            start: { x: this.margin, y: umbralY },\r\n            end: { x: this.margin + chartWidth, y: umbralY },\r\n            thickness: 2,\r\n            color: rgb(0.84, 0, 0),\r\n            dashArray: [5, 5],\r\n        });\r\n    }\r\n\r\n    async processCanvasImage(canvas, lote = null) {\r\n        try {\r\n            // Verificar que el canvas tenga contenido\r\n            const ctx = canvas.getContext('2d');\r\n            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n            const hasContent = imageData.data.some((pixel, index) => {\r\n                // Revisar solo valores RGB (saltar alpha)\r\n                return index % 4 !== 3 && pixel !== 0 && pixel !== 255;\r\n            });\r\n            \r\n            if (!hasContent) {\r\n                console.warn('‚ö†Ô∏è Canvas parece estar vac√≠o o solo con fondo');\r\n                return false;\r\n            }\r\n            \r\n            console.log('üìä Procesando canvas con contenido v√°lido');\r\n            \r\n            const dataURL = canvas.toDataURL('image/png', 1.0);\r\n            \r\n            // Verificar que no sea un canvas completamente transparente\r\n            if (dataURL.length < 1000) {\r\n                console.warn('‚ö†Ô∏è Canvas demasiado peque√±o, probablemente vac√≠o');\r\n                return false;\r\n            }\r\n            \r\n            const imgBytes = this.dataURLtoUint8Array(dataURL);\r\n            const image = await this.pdfDoc.embedPng(imgBytes);\r\n            const originalDims = image.scale(1);\r\n            \r\n            // Escalar para que entre en la p√°gina\r\n            const maxWidth = this.contentWidth;\r\n            const maxHeight = 250;\r\n            \r\n            let scale = Math.min(\r\n                maxWidth / originalDims.width,\r\n                maxHeight / originalDims.height,\r\n                0.8\r\n            );\r\n            \r\n            const imageDims = image.scale(scale);\r\n            \r\n            // Verificar si necesitamos nueva p√°gina\r\n            if (this.currentY - imageDims.height < 100) {\r\n                await this.addNewPage();\r\n            }\r\n            \r\n            // T√≠tulo del gr√°fico\r\n            this.currentPage.drawText('Balance Hidrico - Ultimos 30 dias', {\r\n                x: this.margin,\r\n                y: this.currentY,\r\n                size: 12,\r\n                font: this.boldFont,\r\n                color: rgb(0.26, 0.63, 0.28),\r\n            });\r\n            \r\n            this.currentY -= 25;\r\n            \r\n            // Centrar la imagen\r\n            const imageX = this.margin + (this.contentWidth - imageDims.width) / 2;\r\n            \r\n            // Dibujar imagen del gr√°fico\r\n            this.currentPage.drawImage(image, {\r\n                x: imageX,\r\n                y: this.currentY - imageDims.height,\r\n                width: imageDims.width,\r\n                height: imageDims.height,\r\n            });\r\n            \r\n            this.currentY -= imageDims.height + 20;\r\n            console.log('‚úÖ Gr√°fico capturado y a√±adido exitosamente');\r\n            \r\n            return true;\r\n            \r\n        } catch (error) {\r\n            console.error('‚ùå Error procesando imagen del canvas:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async addEnhancedLoteCards(lote) {\r\n        // Primera fila - Informaci√≥n b√°sica\r\n        const basicCards = [\r\n            { title: 'Cultivo', value: lote.especie || 'N/A', color: rgb(0.26, 0.63, 0.28) },\r\n            { title: 'Variedad', value: lote.variedad || 'N/A', color: rgb(0.26, 0.63, 0.28) },\r\n            { title: 'Campana', value: lote.campa√±a || 'N/A', color: rgb(0.26, 0.63, 0.28) },\r\n            { title: 'Estado Fenologico', value: lote.simulationData?.estadoFenologico || 'N/A', color: rgb(0.26, 0.63, 0.28) }\r\n        ];\r\n        \r\n        this.drawCardRow(basicCards, this.currentY, 110, 50);\r\n        this.currentY -= 70;\r\n        \r\n        // Segunda fila - Datos h√≠dricos con estilo mejorado\r\n        const waterCards = [\r\n            { \r\n                title: 'Agua Util Inicial', \r\n                value: `1m: ${Math.round(lote.simulationData?.auInicial1m || 0)}mm\\n2m: ${Math.round(lote.simulationData?.auInicial2m || 0)}mm`,\r\n                color: rgb(0.25, 0.66, 0.96)\r\n            },\r\n            { \r\n                title: '% Agua Util Actual', \r\n                value: `1m: ${Math.round(lote.waterData?.porcentajeAu1m || 0)}%\\n2m: ${Math.round(lote.waterData?.porcentajeAu2m || 0)}%`,\r\n                color: rgb(0.25, 0.66, 0.96)\r\n            },\r\n            { \r\n                title: 'Proyeccion 7 dias', \r\n                value: `1m: ${Math.round(lote.simulationData?.proyeccionAU1mDia8 || 0)}mm\\n2m: ${Math.round(lote.simulationData?.proyeccionAU2mDia8 || 0)}mm`,\r\n                color: rgb(0.25, 0.66, 0.96)\r\n            }\r\n        ];\r\n        \r\n        this.drawCardRow(waterCards, this.currentY, 150, 60);\r\n        this.currentY -= 80;\r\n    }\r\n\r\n    drawCardRow(cards, startY, cardWidth, cardHeight) {\r\n        const spacing = 15;\r\n        \r\n        cards.forEach((card, index) => {\r\n            const x = this.margin + (index * (cardWidth + spacing));\r\n            \r\n            // Sombra\r\n            this.currentPage.drawRectangle({\r\n                x: x + 2,\r\n                y: startY - cardHeight - 2,\r\n                width: cardWidth,\r\n                height: cardHeight,\r\n                color: rgb(0.9, 0.9, 0.9),\r\n            });\r\n            \r\n            // Fondo de la card\r\n            this.currentPage.drawRectangle({\r\n                x: x,\r\n                y: startY - cardHeight,\r\n                width: cardWidth,\r\n                height: cardHeight,\r\n                color: rgb(0.98, 0.98, 0.98),\r\n                borderColor: card.color,\r\n                borderWidth: 2,\r\n            });\r\n            \r\n            // T√≠tulo con color\r\n            this.currentPage.drawText(card.title, {\r\n                x: x + 8,\r\n                y: startY - 18,\r\n                size: 9,\r\n                font: this.boldFont,\r\n                color: card.color,\r\n            });\r\n            \r\n            // Valor con l√≠neas m√∫ltiples\r\n            const lines = card.value.split('\\n');\r\n            lines.forEach((line, lineIndex) => {\r\n                this.currentPage.drawText(line, {\r\n                    x: x + 8,\r\n                    y: startY - 35 - (lineIndex * 12),\r\n                    size: 10,\r\n                    font: this.font,\r\n                    color: rgb(0, 0, 0),\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    async addChartFallback() {\r\n        // T√≠tulo del gr√°fico\r\n        this.currentPage.drawText('Balance Hidrico - Ultimos 30 dias', {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 12,\r\n            font: this.boldFont,\r\n            color: rgb(0.26, 0.63, 0.28),\r\n        });\r\n        \r\n        this.currentY -= 20;\r\n        \r\n        // Crear un √°rea representando el gr√°fico con m√°s estilo\r\n        const chartHeight = 180;\r\n        const chartWidth = this.contentWidth;\r\n        \r\n        // Fondo del gr√°fico\r\n        this.currentPage.drawRectangle({\r\n            x: this.margin,\r\n            y: this.currentY - chartHeight,\r\n            width: chartWidth,\r\n            height: chartHeight,\r\n            color: rgb(0.98, 0.98, 0.98),\r\n            borderColor: rgb(0.8, 0.8, 0.8),\r\n            borderWidth: 1,\r\n        });\r\n        \r\n        // L√≠neas de grid horizontales\r\n        for (let i = 1; i < 5; i++) {\r\n            const y = this.currentY - (chartHeight * i / 5);\r\n            this.currentPage.drawLine({\r\n                start: { x: this.margin, y: y },\r\n                end: { x: this.margin + chartWidth, y: y },\r\n                thickness: 0.5,\r\n                color: rgb(0.9, 0.9, 0.9),\r\n            });\r\n        }\r\n        \r\n        // L√≠neas de grid verticales\r\n        for (let i = 1; i < 8; i++) {\r\n            const x = this.margin + (chartWidth * i / 8);\r\n            this.currentPage.drawLine({\r\n                start: { x: x, y: this.currentY },\r\n                end: { x: x, y: this.currentY - chartHeight },\r\n                thickness: 0.5,\r\n                color: rgb(0.9, 0.9, 0.9),\r\n            });\r\n        }\r\n        \r\n        // Simular una curva de agua √∫til\r\n        const points = [];\r\n        const numPoints = 30;\r\n        for (let i = 0; i < numPoints; i++) {\r\n            const x = this.margin + (chartWidth * i / (numPoints - 1));\r\n            // Crear una curva que simule variaci√≥n de agua √∫til\r\n            const variation = Math.sin(i * 0.3) * 20 + Math.cos(i * 0.2) * 15;\r\n            const y = this.currentY - chartHeight * 0.3 - variation;\r\n            points.push({ x, y });\r\n        }\r\n        \r\n        // Dibujar la l√≠nea de agua √∫til\r\n        for (let i = 0; i < points.length - 1; i++) {\r\n            this.currentPage.drawLine({\r\n                start: points[i],\r\n                end: points[i + 1],\r\n                thickness: 2,\r\n                color: rgb(0.15, 0.18, 0.54), // Azul oscuro\r\n            });\r\n        }\r\n        \r\n        // L√≠nea de umbral\r\n        const umbralY = this.currentY - chartHeight * 0.6;\r\n        this.currentPage.drawLine({\r\n            start: { x: this.margin, y: umbralY },\r\n            end: { x: this.margin + chartWidth, y: umbralY },\r\n            thickness: 2,\r\n            color: rgb(0.84, 0, 0),\r\n            dashArray: [5, 5],\r\n        });\r\n        \r\n        // Etiquetas\r\n        this.currentPage.drawText('Agua √ötil', {\r\n            x: this.margin + 10,\r\n            y: this.currentY - 30,\r\n            size: 8,\r\n            font: this.font,\r\n            color: rgb(0.15, 0.18, 0.54),\r\n        });\r\n        \r\n        this.currentPage.drawText('Umbral', {\r\n            x: this.margin + 10,\r\n            y: umbralY + 5,\r\n            size: 8,\r\n            font: this.font,\r\n            color: rgb(0.84, 0, 0),\r\n        });\r\n        \r\n        // Texto explicativo\r\n        this.currentPage.drawText('Gr√°fico no disponible en tiempo real', {\r\n            x: this.margin + chartWidth/2 - 80,\r\n            y: this.currentY - chartHeight/2,\r\n            size: 10,\r\n            font: this.font,\r\n            color: rgb(0.6, 0.6, 0.6),\r\n        });\r\n        \r\n        this.currentPage.drawText('Para ver el gr√°fico interactivo completo, acceder a la plataforma web', {\r\n            x: this.margin + 10,\r\n            y: this.currentY - chartHeight - 15,\r\n            size: 8,\r\n            font: this.font,\r\n            color: rgb(0.5, 0.5, 0.5),\r\n        });\r\n        \r\n        this.currentY -= chartHeight + 30;\r\n    }\r\n\r\n    addBalanceSummary(simulationData) {\r\n        if (!simulationData || this.currentY < 120) return;\r\n        \r\n        this.currentPage.drawText('Resumen del Periodo:', {\r\n            x: this.margin,\r\n            y: this.currentY,\r\n            size: 11,\r\n            font: this.boldFont,\r\n            color: rgb(0, 0, 0),\r\n        });\r\n        \r\n        this.currentY -= 15;\r\n        \r\n        const resumen = [\r\n            `‚Ä¢ Lluvia efectiva: ${Math.round(simulationData.lluviasEfectivasAcumuladas || 0)} mm`,\r\n            `‚Ä¢ Riego acumulado: ${Math.round(simulationData.riegoAcumulado || 0)} mm`,\r\n            `‚Ä¢ Agua util actual: ${Math.round(simulationData.aguaUtil?.[simulationData.aguaUtil.length - 1] || 0)} mm`,\r\n            `‚Ä¢ % Agua util: ${Math.round(simulationData.porcentajeAguaUtil || 0)}%`\r\n        ];\r\n        \r\n        resumen.forEach(item => {\r\n            this.currentPage.drawText(item, {\r\n                x: this.margin,\r\n                y: this.currentY,\r\n                size: 9,\r\n                font: this.font,\r\n                color: rgb(0, 0, 0),\r\n            });\r\n            this.currentY -= 12;\r\n        });\r\n        \r\n        this.currentY -= 10;\r\n    }\r\n\r\n    // Utilidades\r\n    dataURLtoUint8Array(dataURL) {\r\n        const arr = dataURL.split(',');\r\n        const bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        const u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return u8arr;\r\n    }\r\n\r\n    splitTextToLines(text, maxWidth, fontSize) {\r\n        const words = text.split(' ');\r\n        const lines = [];\r\n        let currentLine = '';\r\n        \r\n        // Aproximaci√≥n simple para dividir texto\r\n        const avgCharWidth = fontSize * 0.6;\r\n        const maxCharsPerLine = Math.floor(maxWidth / avgCharWidth);\r\n        \r\n        words.forEach(word => {\r\n            if ((currentLine + word).length <= maxCharsPerLine) {\r\n                currentLine += (currentLine ? ' ' : '') + word;\r\n            } else {\r\n                if (currentLine) lines.push(currentLine);\r\n                currentLine = word;\r\n            }\r\n        });\r\n        \r\n        if (currentLine) lines.push(currentLine);\r\n        return lines;\r\n    }\r\n}\r\n\r\nexport default PDFReportGenerator;"],"names":["constructor","this","pdfDoc","currentPage","currentY","pageHeight","pageWidth","margin","contentWidth","templatePaths","window","location","protocol","hostname","origin","font","boldFont","usingTemplate","generateReport","campoData","lotesData","recomendaciones","console","log","PDFDocument","create","embedFont","StandardFonts","Helvetica","HelveticaBold","loadTemplate","addReportTitle","nombre_campo","waitForChartsToLoad","addResumenCirculosFromPage","addRecomendaciones","lote","addLoteDetalleCompleto","pdfBytes","save","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","href","download","format","Date","body","appendChild","click","removeChild","revokeObjectURL","error","elapsed","canvases","querySelectorAll","allLoaded","canvas","ctx","getContext","width","height","getImageData","data","some","pixel","length","Promise","resolve","setTimeout","warn","verifyTemplateAtPath","templatePath","response","fetch","method","headers","mode","credentials","ok","status","contentType","get","includes","text","substring","contentLength","parseInt","arrayBuffer","byteLength","TextDecoder","decode","slice","bytes","Uint8Array","pdfHeader","String","fromCharCode","first50Bytes","Math","min","valid","message","verification","templateDoc","load","templatePages","getPages","templatePage","copyPages","addPage","drawPage","x","y","templateError","Error","addFallbackHeader","drawRectangle","color","rgb","drawText","size","addSimpleFooter","footerY","addNewPage","nombreCampo","captureOnlyLotesCards","selectors","selector","elements","tempContainer","style","display","flexWrap","gap","backgroundColor","padding","forEach","card","clone","cloneNode","flex","html2canvas","scale","useCORS","allowTaint","logging","scrollWidth","scrollHeight","imgData","toDataURL","imgBytes","dataURLtoUint8Array","image","embedPng","imageDims","drawImage","contains","createVisualLotesCards","cardHeight","currentRow","currentCol","i","drawMaterialCard","totalRows","ceil","_lote$waterData","_lote$waterData2","_lote$waterData3","_lote$waterData4","borderColor","borderWidth","nombre_lote","subtitulo","especie","variedad","campa√±a","gauge1X","gauge1Y","gauge2X","gauge2Y","drawVisualGauge","waterData","porcentajeAu1m","porcentajeAu2m","round","aguaUtil1m","aguaUtil2m","centerX","centerY","radius","percentage","label","drawCircle","getColorByPercentage","progressRadius","max","map","c","recomendacion","texto","descripcion","lines","splitTextToLines","line","index","fecha_creacion","fecha","fechaFormateada","toLocaleDateString","addEnhancedLoteCards","captureDetailedChartImproved","success","tryCurrentPageChart","navigateAndCaptureChart","simulationData","createChartFromData","addChartFallback","allCanvases","Array","from","id","className","processCanvasImage","targetUrl","iframe","position","left","src","onload","iframeDoc","contentDocument","contentWindow","_simulationData$fecha","chartHeight","chartWidth","chartStartY","drawLine","start","end","thickness","numVerticalLines","fechas","aguaUtil","maxValue","filter","v","isNaN","minValue","range","puntos","points","value","p","aguaUtilUmbral","umbralValue","umbralY","dashArray","addSimulatedChart","addBalanceSummary","trend","seasonal","sin","random","push","imageData","dataURL","originalDims","maxWidth","maxHeight","imageX","_lote$simulationData","_lote$simulationData2","_lote$simulationData3","_lote$waterData5","_lote$waterData6","_lote$simulationData4","_lote$simulationData5","basicCards","title","estadoFenologico","drawCardRow","waterCards","auInicial1m","auInicial2m","proyeccionAU1mDia8","proyeccionAU2mDia8","cards","startY","cardWidth","split","lineIndex","variation","cos","_simulationData$aguaU","lluviasEfectivasAcumuladas","riegoAcumulado","porcentajeAguaUtil","item","arr","bstr","atob","n","u8arr","charCodeAt","fontSize","words","currentLine","avgCharWidth","maxCharsPerLine","floor","word"],"sourceRoot":""}